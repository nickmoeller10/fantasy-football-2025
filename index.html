/**
 * Fantasy Football Cheat Sheet 2025 - Google Apps Script
 * Creates a professional, color-coded fantasy football analysis tool
 * with dynamic legend and interactive scoring system
 */

function createFantasyFootballCheatSheet() {
  // Create or get the spreadsheet
  const ss = SpreadsheetApp.create('Fantasy Football Cheat Sheet 2025');
  
  // Create all position tabs
  createControlPanel(ss);
  createQBSheet(ss);
  createPlaceholderSheets(ss);
  
  // Set the Control Panel as the active sheet
  ss.setActiveSheet(ss.getSheetByName('Control Panel'));
  
  SpreadsheetApp.getUi().alert('Fantasy Football Cheat Sheet created successfully!\n\nCheck the "Control Panel" tab to customize your scoring system.');
}

function createControlPanel(ss) {
  const sheet = ss.insertSheet('Control Panel');
  
  // Set up the control panel styling
  sheet.getRange('A1:F50').setFontFamily('Inter').setFontSize(11);
  
  // Header
  sheet.getRange('A1:F1').merge().setValue('ðŸˆ FANTASY FOOTBALL CONTROL PANEL 2025')
    .setFontSize(18).setFontWeight('bold').setHorizontalAlignment('center')
    .setBackground('#4285F4').setFontColor('white');
  
  // Spacing
  sheet.setRowHeight(1, 50);
  sheet.setRowHeight(2, 20);
  
  // Section: Scoring System Configuration
  sheet.getRange('A3:F3').merge().setValue('ðŸ“Š SCORING SYSTEM CONFIGURATION')
    .setFontSize(14).setFontWeight('bold').setBackground('#E8F0FE')
    .setHorizontalAlignment('center');
  
  // Age Scoring Configuration
  sheet.getRange('A5').setValue('AGE SCORING RULES').setFontWeight('bold').setBackground('#F8F9FA');
  sheet.getRange('A6').setValue('Prime Age Range (Score = 10):');
  sheet.getRange('B6').setValue('25-30 years');
  sheet.getRange('A7').setValue('Good Age Range (Score = 7-9):');
  sheet.getRange('B7').setValue('23-24, 31-32 years');
  sheet.getRange('A8').setValue('Risk Age Range (Score = 1-6):');
  sheet.getRange('B8').setValue('22 or younger, 33+ years');
  
  // Health Scoring Configuration
  sheet.getRange('A10').setValue('HEALTH SCORING RULES').setFontWeight('bold').setBackground('#F8F9FA');
  sheet.getRange('A11').setValue('Healthy (Score = 9-10):');
  sheet.getRange('B11').setValue('No current injuries, good history');
  sheet.getRange('A12').setValue('Questionable (Score = 5-8):');
  sheet.getRange('B12').setValue('Minor injuries or concerning history');
  sheet.getRange('A13').setValue('Injured (Score = 1-4):');
  sheet.getRange('B13').setValue('Current significant injury');
  
  // Color Legend
  sheet.getRange('A15:F15').merge().setValue('ðŸŽ¨ COLOR CODING LEGEND')
    .setFontSize(14).setFontWeight('bold').setBackground('#E8F0FE')
    .setHorizontalAlignment('center');
  
  sheet.getRange('A17').setValue('Score Range').setFontWeight('bold');
  sheet.getRange('B17').setValue('Color').setFontWeight('bold');
  sheet.getRange('C17').setValue('Meaning').setFontWeight('bold');
  sheet.getRange('D17').setValue('Example').setFontWeight('bold');
  
  sheet.getRange('A18').setValue('8-10');
  sheet.getRange('B18').setValue('Elite').setBackground('#34A853').setFontColor('white').setFontWeight('bold');
  sheet.getRange('C18').setValue('Top tier players');
  sheet.getRange('D18').setValue('Josh Allen, Lamar Jackson');
  
  sheet.getRange('A19').setValue('5-7');
  sheet.getRange('B19').setValue('Above Average').setBackground('#FBBC04').setFontColor('white').setFontWeight('bold');
  sheet.getRange('C19').setValue('Solid starters');
  sheet.getRange('D19').setValue('Dak Prescott, Kyler Murray');
  
  sheet.getRange('A20').setValue('1-4');
  sheet.getRange('B20').setValue('Below Average').setBackground('#EA4335').setFontColor('white').setFontWeight('bold');
  sheet.getRange('C20').setValue('Risky or backup options');
  sheet.getRange('D20').setValue('Rookies, injury concerns');
  
  // Instructions
  sheet.getRange('A22:F22').merge().setValue('ðŸ“‹ HOW TO USE THIS TOOL')
    .setFontSize(14).setFontWeight('bold').setBackground('#E8F0FE')
    .setHorizontalAlignment('center');
  
  sheet.getRange('A24:F30').merge().setValue(
    '1. Review the QB tab to see all quarterback rankings\n' +
    '2. Players are automatically sorted by Final Score (highest to lowest)\n' +
    '3. Colors help you quickly identify elite (green), solid (yellow), and risky (red) options\n' +
    '4. Use the situational factors (OL Rank, WR Corps, etc.) for deeper analysis\n' +
    '5. Update player data throughout the season by modifying the QB sheet\n' +
    '6. RB, WR, TE tabs will be added next - click the buttons below to expand'
  ).setWrap(true).setVerticalAlignment('top');
  
  // Action Buttons
  sheet.getRange('A32').setValue('ðŸ”„ Refresh All Data').setBackground('#4285F4').setFontColor('white')
    .setFontWeight('bold').setHorizontalAlignment('center');
  sheet.getRange('B32').setValue('ðŸ“Š Update QB Rankings').setBackground('#34A853').setFontColor('white')
    .setFontWeight('bold').setHorizontalAlignment('center');
  sheet.getRange('C32').setValue('ðŸ“ˆ Add RB Data').setBackground('#FBBC04').setFontColor('white')
    .setFontWeight('bold').setHorizontalAlignment('center');
  
  // Column widths
  sheet.setColumnWidths(1, 6, 150);
  sheet.getRange('A1:F50').setBorder(true, true, true, true, true, true, '#E0E0E0', SpreadsheetApp.BorderStyle.SOLID);
}

function createQBSheet(ss) {
  const sheet = ss.insertSheet('QB');
  
  // QB Data
  const qbData = [
    ['Josh Allen', 'BUF', 29, 10, 'Healthy', 10, 445, 10, 26.2, 10, 377, 10, 22.2, 10, 8, 10, 7],
    ['Lamar Jackson', 'BAL', 28, 10, 'Healthy', 10, 421, 10, 24.8, 10, 376, 10, 22.1, 10, 7, 10, 8],
    ['Jalen Hurts', 'PHI', 26, 10, 'Healthy', 9, 389, 9, 22.9, 9, 359, 9, 21.1, 9, 10, 9, 10],
    ['Jayden Daniels', 'WAS', 25, 9, 'Healthy', 9, 378, 9, 22.2, 8, 355, 9, 20.9, 9, 7, 8, 8],
    ['Joe Burrow', 'CIN', 28, 10, 'Healthy', 8, 367, 8, 21.6, 8, 341, 8, 20.1, 8, 6, 9, 9],
    ['Patrick Mahomes II', 'KC', 29, 10, 'Healthy', 9, 334, 7, 19.6, 7, 329, 7, 19.4, 7, 6, 8, 7],
    ['Baker Mayfield', 'TB', 29, 10, 'Healthy', 9, 356, 8, 21.0, 8, 322, 7, 18.9, 7, 8, 9, 9],
    ['Kyler Murray', 'ARI', 27, 10, 'Healthy', 7, 298, 6, 17.5, 6, 317, 7, 18.7, 7, 5, 6, 6],
    ['Brock Purdy', 'SF', 25, 9, 'Healthy', 8, 287, 6, 16.9, 6, 311, 7, 18.3, 7, 7, 9, 7],
    ['Bo Nix', 'DEN', 25, 9, 'Healthy', 9, 289, 6, 17.0, 6, 309, 7, 18.2, 7, 9, 7, 6],
    ['Justin Fields', 'NYJ', 26, 10, 'Healthy', 8, 276, 6, 16.2, 5, 301, 6, 17.7, 6, 5, 5, 5],
    ['J.J. McCarthy', 'MIN', 22, 5, 'Healthy', 8, 0, 1, 0, 1, 292, 6, 17.2, 6, 6, 6, 8],
    ['Dak Prescott', 'DAL', 31, 8, 'Healthy', 7, 245, 5, 14.4, 4, 292, 6, 17.2, 6, 6, 6, 7],
    ['Justin Herbert', 'LAC', 26, 10, 'Healthy', 8, 267, 5, 15.7, 5, 291, 6, 17.1, 6, 5, 7, 6],
    ['Jared Goff', 'DET', 30, 9, 'Healthy', 9, 312, 7, 18.4, 7, 288, 6, 17.0, 6, 8, 9, 10],
    ['Caleb Williams', 'CHI', 23, 6, 'Healthy', 9, 234, 4, 13.8, 4, 287, 6, 16.9, 6, 8, 6, 7],
    ['C.J. Stroud', 'HOU', 23, 6, 'Healthy', 9, 267, 5, 15.7, 5, 280, 5, 16.5, 5, 3, 5, 7],
    ['Jordan Love', 'GB', 26, 10, 'Thumb Injury', 7, 289, 6, 17.0, 6, 278, 5, 16.4, 5, 7, 7, 6],
    ['Drake Maye', 'NE', 22, 5, 'Healthy', 8, 187, 3, 11.0, 3, 276, 5, 16.2, 5, 2, 4, 3],
    ['Trevor Lawrence', 'JAC', 26, 10, 'Healthy', 7, 234, 4, 13.8, 4, 275, 5, 16.2, 5, 2, 5, 6]
  ];
  
  // Headers
  const headers = [
    'Player', 'Team', 'Age', 'Age Score', 'Injury Status', 'Health Score',
    '2024 Total Points', '2024 Points Score', '2024 PPG', '2024 PPG Score',
    '2025 Proj Points', '2025 Proj Score', '2025 Proj PPG', '2025 PPG Score',
    'OL Rank', 'Off Proj Rank', 'WR Corps Rank', 'Final Score'
  ];
  
  // Set up header row
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  sheet.getRange(1, 1, 1, headers.length)
    .setBackground('#1a73e8')
    .setFontColor('white')
    .setFontWeight('bold')
    .setFontFamily('Inter')
    .setFontSize(11)
    .setHorizontalAlignment('center')
    .setVerticalAlignment('middle');
  
  // Calculate final scores and add to data
  const processedData = qbData.map(row => {
    const scores = [row[3], row[5], row[7], row[9], row[11], row[13], row[14], row[15], row[16]]; // All score columns
    const finalScore = Math.round(scores.reduce((sum, score) => sum + score, 0) / scores.length * 10) / 10;
    return [...row, finalScore];
  });
  
  // Sort by final score (descending)
  processedData.sort((a, b) => b[17] - a[17]);
  
  // Add data
  sheet.getRange(2, 1, processedData.length, headers.length).setValues(processedData);
  
  // Apply formatting
  const dataRange = sheet.getRange(1, 1, processedData.length + 1, headers.length);
  dataRange.setFontFamily('Inter').setFontSize(10);
  
  // Freeze header row
  sheet.setFrozenRows(1);
  
  // Set row heights
  sheet.setRowHeight(1, 40);
  for (let i = 2; i <= processedData.length + 1; i++) {
    sheet.setRowHeight(i, 30);
  }
  
  // Column widths
  const columnWidths = [140, 50, 40, 50, 100, 60, 80, 60, 50, 60, 80, 60, 60, 60, 50, 60, 60, 70];
  columnWidths.forEach((width, index) => {
    sheet.setColumnWidth(index + 1, width);
  });
  
  // Apply conditional formatting and styling
  applyQBFormatting(sheet, processedData.length);
  
  // Add borders
  dataRange.setBorder(true, true, true, true, true, true, '#e0e0e0', SpreadsheetApp.BorderStyle.SOLID);
  
  // Player name column - bold and left aligned
  sheet.getRange(2, 1, processedData.length, 1).setFontWeight('bold').setHorizontalAlignment('left');
  
  // Team column - bold and colored
  sheet.getRange(2, 2, processedData.length, 1).setFontWeight('bold').setFontColor('#1565c0');
  
  // Final score column - special formatting
  sheet.getRange(2, 18, processedData.length, 1)
    .setBackground('#ff6b6b')
    .setFontColor('white')
    .setFontWeight('bold')
    .setFontSize(12)
    .setHorizontalAlignment('center');
}

function applyQBFormatting(sheet, numRows) {
  // Score columns to format (Age Score, Health Score, 2024 Points Score, etc.)
  const scoreColumns = [4, 6, 8, 10, 12, 14, 15, 16, 17]; // Column indices for scores
  
  scoreColumns.forEach(colIndex => {
    const range = sheet.getRange(2, colIndex, numRows);
    
    // Create conditional formatting rules
    const rules = sheet.getConditionalFormatRules();
    
    // Elite (8-10) - Green
    const eliteRule = SpreadsheetApp.newConditionalFormatRule()
      .setRanges([range])
      .whenNumberGreaterThanOrEqualTo(8)
      .setBackground('#34a853')
      .setFontColor('white')
      .setBold(true)
      .build();
    
    // Above Average (5-7) - Yellow
    const avgRule = SpreadsheetApp.newConditionalFormatRule()
      .setRanges([range])
      .whenNumberBetween(5, 7)
      .setBackground('#fbbc04')
      .setFontColor('white')
      .setBold(true)
      .build();
    
    // Below Average (1-4) - Red
    const lowRule = SpreadsheetApp.newConditionalFormatRule()
      .setRanges([range])
      .whenNumberLessThan(5)
      .setBackground('#ea4335')
      .setFontColor('white')
      .setBold(true)
      .build();
    
    rules.push(eliteRule, avgRule, lowRule);
    sheet.setConditionalFormatRules(rules);
  });
  
  // Special formatting for injury status column
  const injuryRange = sheet.getRange(2, 5, numRows);
  const injuryValues = injuryRange.getValues();
  
  injuryValues.forEach((row, index) => {
    const cell = sheet.getRange(index + 2, 5);
    const status = row[0].toString().toLowerCase();
    
    if (status === 'healthy') {
      cell.setBackground('#34a853').setFontColor('white').setFontWeight('bold');
    } else if (status.includes('questionable') || status.includes('day-to-day')) {
      cell.setBackground('#fbbc04').setFontColor('white').setFontWeight('bold');
    } else {
      cell.setBackground('#ea4335').setFontColor('white').setFontWeight('bold');
    }
  });
  
  // Center align score columns
  scoreColumns.forEach(colIndex => {
    sheet.getRange(2, colIndex, numRows).setHorizontalAlignment('center');
  });
}

function createPlaceholderSheets(ss) {
  const positions = ['RB', 'WR', 'TE', 'K', 'DST'];
  
  positions.forEach(position => {
    const sheet = ss.insertSheet(position);
    
    // Header
    sheet.getRange('A1:E1').merge().setValue(`${position} - Coming Soon`)
      .setFontSize(24).setFontWeight('bold').setHorizontalAlignment('center')
      .setBackground('#4285F4').setFontColor('white');
    
    sheet.setRowHeight(1, 60);
    
    // Placeholder content
    sheet.getRange('A3:E10').merge().setValue(
      `${position} data will be added next!\n\n` +
      `This will include:\n` +
      `â€¢ Player rankings and projections\n` +
      `â€¢ Situational analysis\n` +
      `â€¢ Color-coded scoring system\n` +
      `â€¢ Advanced metrics\n\n` +
      `Stay tuned for updates!`
    ).setWrap(true).setVerticalAlignment('middle').setHorizontalAlignment('center')
     .setFontSize(14).setBackground('#f8f9fa');
    
    sheet.setColumnWidths(1, 5, 120);
  });
}

// Helper function to refresh QB data (can be called from Control Panel)
function refreshQBData() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const qbSheet = ss.getSheetByName('QB');
  
  if (qbSheet) {
    // Clear existing data (except headers)
    qbSheet.getRange(2, 1, qbSheet.getLastRow() - 1, qbSheet.getLastColumn()).clear();
    
    // Recreate the QB sheet
    ss.deleteSheet(qbSheet);
    createQBSheet(ss);
    
    SpreadsheetApp.getUi().alert('QB data refreshed successfully!');
  }
}

/**
 * HOW TO USE THIS SCRIPT:
 * 
 * 1. Open Google Sheets
 * 2. Go to Extensions > Apps Script
 * 3. Delete any existing code in the editor
 * 4. Paste this entire script
 * 5. Save the project (Ctrl+S)
 * 6. Click "Run" button next to "createFantasyFootballCheatSheet"
 * 7. Grant permissions when prompted
 * 8. Your spreadsheet will be created automatically!
 * 
 * The script creates:
 * - Control Panel with customizable scoring rules
 * - Professionally formatted QB sheet with color coding
 * - Placeholder sheets for other positions
 * - Interactive elements and sorting
 */
